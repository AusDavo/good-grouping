<%- include('../layout', { body: `
<div class="max-w-lg mx-auto space-y-6">
  <h1 class="text-2xl font-pub-heading text-neon-pink" style="text-shadow: 0 0 10px #ff2d95;">
    Game Lobby
  </h1>

  <div class="card rounded-xl p-6">
    <!-- Game Info -->
    <div class="text-center mb-6">
      <div class="text-3xl font-pub-heading text-neon-blue mb-2">${game.game_type}</div>
      ${game.starting_score ? `
        <div class="text-pub-chalk-accent">Starting Score: ${game.starting_score}</div>
      ` : ''}
      ${series ? `
        <div class="text-sm text-neon-yellow mt-1">Game ${gameNumberInSeries} of ${series.series_length}</div>
        <div class="flex justify-center gap-4 mt-2 text-xs text-pub-chalk-accent">
          ${series.players.map(sp => `<span>${sp.name}: ${sp.wins} ${sp.wins === 1 ? 'win' : 'wins'}</span>`).join('')}
        </div>
      ` : ''}
      <div class="text-sm text-pub-chalk-accent mt-2">
        Created by ${game.created_by_name}
      </div>
    </div>

    <!-- Players List -->
    <div class="mb-6">
      <h2 class="text-sm font-pub-heading text-pub-chalk-accent mb-3">Player Order</h2>
      <div class="space-y-2">
        ${game.players.map((player, index) => `
          <div class="flex items-center gap-3 p-3 bg-pub-wood-dark/50 rounded-lg">
            <div class="w-8 h-8 rounded-full bg-pub-green-700 flex items-center justify-center border-2 border-neon-green text-neon-green font-bold text-sm">
              ${index + 1}
            </div>
            ${player.avatar_url ? `
              <img src="${player.avatar_url}" alt="" class="w-8 h-8 rounded-full object-cover">
            ` : ''}
            <span class="text-aged-cream font-pub-heading flex-1">${player.name}</span>
            ${isCreator && game.players.length > 1 ? `
              <div class="flex flex-col gap-1">
                ${index > 0 ? `
                  <form action="/live-games/${game.id}/reorder" method="POST" class="inline">
                    <input type="hidden" name="playerIdA" value="${player.id}">
                    <input type="hidden" name="playerIdB" value="${game.players[index - 1].id}">
                    <button type="submit" class="w-7 h-7 rounded bg-pub-wood-medium text-pub-chalk-accent hover:text-aged-cream hover:bg-pub-wood-light flex items-center justify-center text-xs" title="Move up">
                      &#9650;
                    </button>
                  </form>
                ` : `<div class="w-7 h-7"></div>`}
                ${index < game.players.length - 1 ? `
                  <form action="/live-games/${game.id}/reorder" method="POST" class="inline">
                    <input type="hidden" name="playerIdA" value="${player.id}">
                    <input type="hidden" name="playerIdB" value="${game.players[index + 1].id}">
                    <button type="submit" class="w-7 h-7 rounded bg-pub-wood-medium text-pub-chalk-accent hover:text-aged-cream hover:bg-pub-wood-light flex items-center justify-center text-xs" title="Move down">
                      &#9660;
                    </button>
                  </form>
                ` : `<div class="w-7 h-7"></div>`}
              </div>
            ` : ''}
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Actions -->
    <div class="space-y-3">
      ${isCreator ? `
        <form action="/live-games/${game.id}/start" method="POST">
          <button type="submit" class="w-full btn-neon-green px-6 py-3 rounded-lg font-pub-heading text-lg">
            Start Game
          </button>
        </form>
        <form action="/live-games/${game.id}/abandon" method="POST" onsubmit="return confirm('Abandon this game?')">
          <button type="submit" class="w-full btn-neon-orange px-4 py-2 rounded-lg font-pub-heading text-sm">
            Abandon Game
          </button>
        </form>
      ` : isPlayer ? `
        <div class="text-center text-pub-chalk-accent p-4">
          <div class="animate-pulse text-neon-yellow">Waiting for ${game.created_by_name} to start the game...</div>
        </div>
      ` : `
        <div class="text-center text-pub-chalk-accent p-4">
          <div class="text-neon-blue">You're spectating this game</div>
        </div>
      `}

      <a href="/live-games" class="block text-center text-pub-chalk-accent hover:text-neon-blue text-sm">
        Back to Live Games
      </a>
    </div>
  </div>
</div>

<script>
  // Auto-refresh to check if game started
  setInterval(() => {
    fetch('/live-games/${game.id}/state')
      .then(r => r.json())
      .then(data => {
        if (data.status === 'playing') {
          window.location.href = '/live-games/${game.id}/play';
        }
      })
      .catch(() => {});
  }, 3000);
</script>
` }) %>
