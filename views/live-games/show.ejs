<%- include('../layout', { body: `
<div class="max-w-lg mx-auto space-y-6">
  <h1 class="text-2xl font-pub-heading text-neon-pink" style="text-shadow: 0 0 10px #ff2d95;">
    ${game.game_type} - Summary
  </h1>

  <div class="card rounded-xl p-6">
    <!-- Game Status -->
    <div class="text-center mb-6">
      ${game.status === 'finished' && winner ? `
        <div class="text-5xl mb-2">&#127942;</div>
        <div class="text-2xl font-pub-heading text-neon-green mb-2">${winner.name} Wins!</div>
      ` : game.status === 'waiting' ? `
        <div class="text-xl text-yellow-400">Waiting to Start</div>
      ` : game.status === 'playing' ? `
        <div class="text-xl text-neon-blue animate-pulse">Game in Progress</div>
      ` : `
        <div class="text-xl text-pub-chalk-accent">Game Ended</div>
      `}
    </div>

    ${series ? `
      <!-- Series Standings -->
      <div class="mb-6 p-4 rounded-lg bg-pub-wood-dark/50 border border-pub-wood-medium">
        <h2 class="text-sm font-pub-heading text-neon-yellow mb-3">
          Series - Best of ${series.series_length}
          ${seriesDecided ? ' (Decided)' : ''}
        </h2>
        <div class="space-y-2">
          ${series.players.map(sp => `
            <div class="flex items-center justify-between p-2 rounded ${seriesDecided && seriesWinner && seriesWinner.user_id === sp.user_id ? 'bg-green-900/30 border border-green-500' : ''}">
              <span class="font-pub-heading text-aged-cream">${sp.name}</span>
              <span class="text-lg font-bold ${sp.wins > 0 ? 'text-neon-green' : 'text-pub-chalk-accent'}">${sp.wins} ${sp.wins === 1 ? 'win' : 'wins'}</span>
            </div>
          `).join('')}
        </div>
        <div class="text-xs text-pub-chalk-accent mt-2">
          Game ${series.games.length} of up to ${series.series_length}
        </div>
      </div>
    ` : ''}

    <!-- Final Scores -->
    <div class="mb-6">
      <h2 class="text-sm font-pub-heading text-pub-chalk-accent mb-3">Final Scores</h2>
      <div class="space-y-2">
        ${game.players.map((player, index) => `
          <div class="flex items-center justify-between p-3 rounded-lg
            ${player.id === game.winner_player_id ? 'bg-green-900/30 border border-green-500' : 'bg-pub-wood-dark/50'}">
            <div class="flex items-center gap-3">
              ${player.id === game.winner_player_id ? `
                <span class="text-xl">&#127942;</span>
              ` : `
                <span class="w-6 h-6 rounded-full bg-pub-wood-medium flex items-center justify-center text-sm text-pub-chalk-accent">
                  ${index + 1}
                </span>
              `}
              <span class="font-pub-heading ${player.id === game.winner_player_id ? 'text-neon-green' : 'text-aged-cream'}">
                ${player.name}
              </span>
            </div>
            <div class="text-right">
              ${game.game_type === 'Cricket' ? `
                <span class="text-lg font-bold text-neon-blue">${player.cricket_points || 0} pts</span>
              ` : (game.game_type === '301' || game.game_type === '501') ? `
                <span class="text-lg font-bold ${player.remaining_score === 0 ? 'text-neon-green' : 'text-neon-blue'}">
                  ${player.remaining_score}
                </span>
              ` : game.game_type === 'Around the World' ? `
                <span class="text-lg font-bold text-neon-blue">
                  ${player.current_target > 21 ? 'Complete!' : 'Target: ' + (player.current_target > 20 ? 'Bull' : player.current_target)}
                </span>
              ` : ''}
            </div>
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Game Info -->
    <div class="text-sm text-pub-chalk-accent space-y-1 mb-6">
      <div>Created by: ${game.created_by_name}</div>
      ${game.started_at ? `
        <div>Started: ${new Date(game.started_at).toLocaleString()}</div>
      ` : ''}
      ${game.finished_at ? `
        <div>Finished: ${new Date(game.finished_at).toLocaleString()}</div>
      ` : ''}
      ${game.throws ? `
        <div>Total Throws: ${game.throws.length}</div>
      ` : ''}
    </div>

    <!-- Actions -->
    <div class="space-y-3">
      ${game.status === 'playing' ? `
        <a href="/live-games/${game.id}/play" class="block w-full btn-neon-green px-6 py-3 rounded-lg font-pub-heading text-center">
          Continue Playing
        </a>
      ` : game.status === 'finished' ? `
        ${series && !seriesDecided ? `
          <!-- Series not decided - Next game button -->
          <form action="/live-games/${game.id}/next-in-series" method="POST">
            <button type="submit" class="w-full btn-neon-green px-6 py-3 rounded-lg font-pub-heading">
              Next Game in Series
            </button>
          </form>
        ` : series && seriesDecided ? `
          <!-- Series decided -->
          <div class="text-center p-3 bg-green-900/20 rounded-lg border border-green-700 mb-2">
            <div class="text-neon-green font-pub-heading">${seriesWinner.name} wins the series!</div>
          </div>
          <form action="/live-games/${game.id}/extend-series" method="POST">
            <button type="submit" class="w-full btn-neon-yellow px-6 py-3 rounded-lg font-pub-heading">
              Extend Series (+2)
            </button>
          </form>
        ` : ''}
        ${isPlayer ? `
          <form action="/live-games/${game.id}/finalize" method="POST">
            <button type="submit" class="w-full btn-neon-blue px-6 py-3 rounded-lg font-pub-heading">
              Finalize & Track Crown
            </button>
          </form>
          <p class="text-xs text-pub-chalk-accent text-center">
            Finalizing will record this game officially${series ? (seriesDecided ? ' and update crown standings' : '. Crown will be awarded when the series is decided') : ' and update crown standings'}.
          </p>
        ` : ''}
      ` : ''}

      <a href="/live-games" class="block text-center text-pub-chalk-accent hover:text-neon-blue text-sm">
        Back to Live Games
      </a>
    </div>
  </div>

  <!-- Throw History -->
  ${game.throws && game.throws.length > 0 ? `
    <div class="card rounded-xl p-4">
      <h3 class="text-sm font-pub-heading text-pub-chalk-accent mb-3">Throw History</h3>
      <div class="max-h-60 overflow-y-auto scrollbar-pub">
        <div class="flex flex-wrap gap-2">
          ${game.throws.map((t, idx) => `
            <span class="px-2 py-1 rounded text-xs ${t.is_bust ? 'bg-red-900 text-red-300' : 'bg-pub-wood-medium text-aged-cream'}"
              title="Throw #${idx + 1}">
              ${t.segment ? (t.multiplier > 1 ? (t.multiplier === 3 ? 'T' : 'D') : '') + (t.segment === 25 ? 'Bull' : t.segment) : 'Miss'}
              ${t.is_bust ? '(B)' : ''}
            </span>
          `).join('')}
        </div>
      </div>
    </div>
  ` : ''}
</div>
` }) %>
