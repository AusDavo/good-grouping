<%- include('../layout', { body: `
<div class="page-header">
  <h1>Record New Game</h1>
</div>

${typeof error !== 'undefined' && error ? `<div class="alert alert-error">${error}</div>` : ''}

<form action="/games" method="POST" class="game-form" id="game-form">
  <div class="form-group">
    <label for="playedAt">Date Played</label>
    <input type="date" id="playedAt" name="playedAt" value="${new Date().toISOString().split('T')[0]}" required>
  </div>

  <div class="form-group">
    <label for="gameType">Game Type</label>
    <select id="gameType" name="gameType">
      <option value="Cricket" selected>Cricket</option>
      <option value="301">301</option>
      <option value="501">501</option>
      <option value="Around the World">Around the World</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <div class="form-group">
    <label>Players</label>
    <div id="players-container">
      <div class="player-row">
        <select name="players[0][userId]" required>
          <option value="">Select player...</option>
          ${allUsers.map(u => `<option value="${u.id}">${u.name}</option>`).join('')}
        </select>
        <input type="number" name="players[0][score]" placeholder="Score (optional)">
        <label class="winner-label">
          <input type="checkbox" name="players[0][isWinner]" value="true"> Winner
        </label>
      </div>
      <div class="player-row">
        <select name="players[1][userId]" required>
          <option value="">Select player...</option>
          ${allUsers.map(u => `<option value="${u.id}">${u.name}</option>`).join('')}
        </select>
        <input type="number" name="players[1][score]" placeholder="Score (optional)">
        <label class="winner-label">
          <input type="checkbox" name="players[1][isWinner]" value="true"> Winner
        </label>
      </div>
    </div>
    <button type="button" id="add-player" class="btn btn-secondary btn-sm">Add Player</button>
  </div>

  <div class="form-group">
    <label for="notes">Notes (optional)</label>
    <textarea id="notes" name="notes" rows="3" placeholder="Any additional notes about the game..."></textarea>
  </div>

  <div class="form-actions">
    <a href="/" class="btn btn-secondary">Cancel</a>
    <button type="submit" class="btn btn-primary">Save Game</button>
  </div>
</form>

<script>
const allUsers = ${JSON.stringify(allUsers)};
let playerCount = 2;

document.getElementById('add-player').addEventListener('click', function() {
  const container = document.getElementById('players-container');
  const row = document.createElement('div');
  row.className = 'player-row';
  row.innerHTML = \`
    <select name="players[\${playerCount}][userId]">
      <option value="">Select player...</option>
      \${allUsers.map(u => \`<option value="\${u.id}">\${u.name}</option>\`).join('')}
    </select>
    <input type="number" name="players[\${playerCount}][score]" placeholder="Score (optional)">
    <label class="winner-label">
      <input type="checkbox" name="players[\${playerCount}][isWinner]" value="true"> Winner
    </label>
    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">Remove</button>
  \`;
  container.appendChild(row);
  playerCount++;
});
</script>
` }) %>
